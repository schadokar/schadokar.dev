<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>How to create a CLI in golang with cobra | Shubham Chadokar</title>



<link href="https://schadokar.dev/index.xml" rel="alternate" type="application/rss+xml" title="Shubham Chadokar" />

<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://schadokar.dev/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://schadokar.dev/posts/how-to-create-a-cli-in-golang-with-cobra/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://schadokar.dev">
          <h1 id="nav-heading" class="title is-4">Shubham Chadokar</h1>
        </a>
      </div>
      <div class="nav-right">

        <nav id="nav-items" class="nav-item level is-mobile">
          <nav class="nav-links">
            <a href="/about">About Me</a>
          </nav>
          <nav class="nav-links">
            <a href="/projects">Projects</a>
          </nav>
          <nav class="nav-links">
            <a href="/subscribe">Subscribe</a>
          </nav>
          <nav class="nav-links">
            <a href="/contact">Contact</a>
          </nav>
        </nav>

      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/golang">#golang</a>



  
  | <a class="subtitle is-6" href="/tags/cobra">#cobra</a>
  
  | <a class="subtitle is-6" href="/tags/tutorial">#tutorial</a>
  

      
    </div>
    <h2 class="subtitle is-6">November 18, 2019</h2>
    <h1 class="title">How to create a CLI in golang with cobra</h1>
    


    <div class="content">
      <p><img src="./asset-1.jpeg" alt="Photo by Marvin Meyer on¬†Unsplash"></p>
<p>Have you ever wonder why in the world of GUI, CLI still exist? You‚Äôll better understand it when you build one of your own.</p>
<p>When you learn golang then it is very often that you‚Äôll come across that ‚Äògolang is great to build cli tools‚Äô. This fascinated me too. So, I tried to get my hands dirty and found a few tutorials of creating a cli but most of all are not basic. In this tutorial, I‚Äôll try to smooth the learning curve.</p>
<p>This is the basic cli application where we are going to cover basic cli operations. I am planning to write another article with advance cli operations but that‚Äôs for later.</p>
<p>We are creating a simple mathematical cli which will be capable of doing the following 2 jobs:</p>
<ul>
<li>addition of numbers</li>
<li>addition of only even or odd numbers</li>
</ul>
<p>I know these jobs don‚Äôt meet your expectations but trust me, after this, you will feel comfortable with building a cli.</p>
<hr>
<h3 id="what-is-cli-command-line-interface">What is CLI? (Command Line Interface)</h3>
<p>CLI works on the basic principle of software engineering, takes the input, process it and gives the output. In the cli tool instead of a flashing frontend, it takes the input from the <strong>black window</strong>. <em>Remember, Matrix Trilogy</em>.</p>
<p>If you are using <strong>Windows</strong> just type <code>cmd</code> or <code>powershell</code> in the <code>start</code>and enter, the black window or blue window is a cli.</p>
<p><img src="./asset-2.png" alt="cmd"></p>
<p>In Mac or Linux it is known by the name <code>terminal</code>¬†.</p>
<blockquote>
<p>A <a href="https://en.wikipedia.org/wiki/Command-line_interface"><strong>command-line interface</strong> (<strong>CLI</strong>)</a> is a means of interacting with a <a href="https://en.wikipedia.org/wiki/Computer_program" title="Computer program">computer program</a> where the <a href="https://en.wikipedia.org/wiki/User_%28computing%29" title="User (computing)">user</a> (or <a href="https://en.wikipedia.org/wiki/Client_%28computing%29" title="Client (computing)">client</a>) issues <a href="https://en.wikipedia.org/wiki/Command_%28computing%29" title="Command (computing)">commands</a> to the program in the form of successive lines of text (command lines). The program which handles the interface is called a <strong>command-line interpreter</strong> or <strong>command-line processor</strong>.‚Ää‚Äî‚Ää<a href="https://en.wikipedia.org/wiki/Command-line_interface">wikipedia</a></p>
</blockquote>
<p>There are many CLIs‚Äô you might work on like npm, node, go, python, docker, Kubernetes etc. All are an ideal interface to interact with the software.</p>
<h4 id="why-they-are-still-usingcli">Why they are still using¬†CLI?</h4>
<ul>
<li>It is lightweight and fast.</li>
<li>Minimal or no dependencies.</li>
<li>Best for system administration and task-based automation etc.</li>
</ul>
<hr>
<p>Enough of theory, let‚Äôs start with the requirements:</p>
<ul>
<li>golang installed (I am using go1.11.5 windows/amd64)</li>
<li>Cobra library (<code>go get -u github.com/spf13/cobra/cobra</code>)</li>
<li>Any code editor of your choice. (I am using VS Code)</li>
</ul>
<blockquote>
<p>I recommend to use VS code and install the <code>go</code> extension by Microsoft. This will update the import statement according to the code. If you use a new package, it will import that package on save. If a package is imported and not used, it will remove that package from the import.</p>
</blockquote>
<p>A little introduction to the <code>Cobra</code> library. We will use cobra cli to use the cobra library. We will use a cli to build a cli üòÉ</p>
<blockquote>
<p><a href="https://github.com/spf13/cobra">Cobra</a> is both a library for creating powerful modern CLI applications as well as a program to generate applications and command¬†files.</p>
</blockquote>
<blockquote>
<p>Many of the most widely used Go projects are built using Cobra, such as: <a href="http://kubernetes.io/">Kubernetes</a>, <a href="http://gohugo.io/">Hugo</a>, <a href="https://github.com/docker/distribution">Docker (distribution)</a> etc.‚Ää‚Äî‚Ää<a href="https://github.com/spf13/cobra">Github</a></p>
</blockquote>
<hr>
<h3 id="cobra-concepts">Cobra Concepts</h3>
<p>Cobra is built on a structure of commands, arguments &amp; flags.</p>
<ul>
<li><strong>Commands</strong> represent actions</li>
<li><strong>Args</strong> are things</li>
<li><strong>Flags</strong> are modifiers for those actions</li>
</ul>
<p>The basic structure will be like a simple sentence</p>
<p><code>APPNAME Command Args --Flags</code> or <code>APPNAME Command --Flags Args</code></p>
<p><strong>For Ex.</strong></p>
<ul>
<li><code>git clone URL -bare</code></li>
<li><code>go get -u URL</code></li>
<li><code>npm install package --save</code></li>
<li><code>docker run image -d</code></li>
</ul>
<hr>
<p>Create a new project directory <strong>outside</strong> the <strong>GOPATH</strong>. I have created <code>my-calc</code> project directory for this tutorial. You can name any of your choices.</p>
<p>Creating projects outside the <strong>GOPATH</strong> ease the importing local files. Initialize modules in the project. This module will keep all the libraries and dependency require and used in this project. It is similar to the <code>package.json</code> in the nodejs. To read more about the modules, please read this great <a href="https://medium.com/rungo/anatomy-of-modules-in-go-c8274d215c16">article</a>.</p>
<blockquote>
<p>A <em>module</em> is a collection of related Go packages that are versioned together as a single¬†unit.</p>
</blockquote>
<blockquote>
<p>Modules record precise dependency requirements and create reproducible builds.‚Ää‚Äî‚Ää<a href="http://A%20module%20is%20a%20collection%20of%20related%20Go%20packages%20that%20are%20versioned%20together%20as%20a%20single%20unit.%20%20Modules%20record%20precise%20dependency%20requirements%20and%20create%20reproducible%20builds.">wiki</a></p>
</blockquote>
<p>Open the project directory in the command line of your choices. I am using <code>bash</code>. Once you are inside the project directory, run the below command to initialize the modules.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">mod</span> <span style="color:#a6e22e">init</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">calc</span>
</code></pre></div><p>You can notice that it creates a <code>go.mod</code> file in the project.</p>
<blockquote>
<p><strong>Note:</strong> Creating modules inside the <code>$GOPATH</code>is disabled by default. You will get this error if you run above command‚Ää‚Äî‚Ää<code>go: modules disabled inside GOPATH/src by GO111MODULE=auto; see ‚Äògo help modules‚Äô</code>¬†. If you still want to create the go modules inside the <code>$GOPATH</code> then first set <code>GO111MODULE</code> environment variable to <code>on</code>. <code>export GO111MODULE=on</code></p>
</blockquote>
<p>Now whenever you use any third-party packages in the project, it‚Äôll save it as a dependency with their version. In this way, even if a breaking change introduces in the new version of the library, your project will work as expected.</p>
<hr>
<p>If you still haven‚Äôt installed the <code>cobra</code> library, you can install it using below command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">get</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span> <span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">spf13</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cobra</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cobra</span>
</code></pre></div><p>Initialize the cli scaffolding for the project using <code>cobra init</code>command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">cobra</span> <span style="color:#a6e22e">init</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">calc</span>
</code></pre></div><p>It will initialize the <code>my-calc</code> project with <code>cobra</code> library. You can observe that it created a few files in the project.</p>
<pre><code>‚ñæ my-calc/
  ‚ñæ cmd/
     root.go
   main.go
</code></pre><p>The <code>main.go</code> is the entry point of the <code>cli</code>¬†. Inside the <code>main.go</code> it is calling the <code>Execute</code> function of the <code>cmd/root.go</code>¬†.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// main.go
</span><span style="color:#75715e"></span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;my-calc/cmd&#34;</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
   <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Execute</span>()
}
</code></pre></div><p>Let‚Äôs examine the <code>root.go</code>¬†.</p>
<h3 id="rootcmd">rootCmd</h3>
<p>Root command is the base command of any cli. For Ex. <code>go get URL</code>‚Ää‚Äî‚Ää<code>go</code> is the root command here and <code>get</code> is the child command of the <code>go</code>. In the <code>root.go</code> it is initiating the <code>rootCmd</code> struct variable with the <code>cobra</code> command. All the other commands in the cli will be a child of the <code>rootCmd</code>.</p>
<p>Open the <code>root.go</code> in the editor and inside the <code>rootCmd</code> uncomment the</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {},
</code></pre></div><p>And paste the <code>fmt.Println(&quot;Hello CLI&quot;)</code> inside the curly braces.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello CLI&#34;</span>},
</code></pre></div><blockquote>
<p>‚ö†Ô∏è Don‚Äôt remove the comma after the closing curly braces. It will throw syntax¬†error.</p>
</blockquote>
<p>Open the terminal inside the <code>my-calc</code> project and run</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">calc</span>
</code></pre></div><p>This command will generate the binary or executable file of the project in the <code>$GOPATH/bin</code> folder.</p>
<p>Now run <code>my-calc</code> in the terminal. As it is saved in the bin folder you don‚Äôt have to set the environment variable for this.</p>
<blockquote>
<p>The name of cli is the <strong>rootCmd</strong>. <strong>my-calc</strong> is the¬†rootCmd.</p>
</blockquote>
<p>You will see the output similar to this.</p>
<p><img src="./asset-3.png" alt="hello-cli"></p>
<hr>
<h3 id="init">init</h3>
<p>This is the first function which gets called whenever a package initialize in the golang. The <code>cobra.OnInitialize(funcDeclarations)</code> append the user-defined functions in the command‚Äôs initialization. <strong><em>Whenever the command run or called it will first execute all the functions in the command‚Äôs initialization and then it will run the execute method.</em></strong> This initialization can be used in loading the configuration file or can be used as constructor. It all depends on your use case and your creativity.</p>
<p>I believe I lost you here. Let‚Äôs understand this with an example.</p>
<p>In the <code>root.go</code>¬†, the command is the <code>rootCmd</code>.</p>
<p>The <code>cobra.OnInitialize(initConfig)</code> append the <code>initConfig</code>function declaration in the <code>rootCmd</code>‚Äôs initialization. So, whenever the <code>rootCmd</code> ‚Äòs execute method (<code>RUN: func</code>) run, the <code>rootCmd</code> will first run the <code>initConfig</code>function. Once the execution of all the initialize functions over, it will run the <code>RUN: func</code> execution method of <code>rootCmd</code>.</p>
<p>To visualize it, add a print message in the <code>initConfig</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">initConfig</span>() {

   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;inside initConfig&#34;</span>)
<span style="color:#f92672">...</span>
</code></pre></div><p>Save the changes. Open the terminal inside the <code>my-calc</code> project.</p>
<p>Rebuild the binary <code>go install my-calc</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">calc</span>
</code></pre></div><p>Run <code>my-calc</code>. Whenever you‚Äôll make any changes in the cli you have to rebuild the binary. Run <code>go install my-calc</code> to reflect it in the cli commands.</p>
<p><img src="./asset-4.png" alt="initConfig"></p>
<p>You can see that <code>initConfig</code> run first and later <code>Hello CLI</code>¬†.</p>
<p>To understand the complete flow of cli, add a message inside the <code>init</code> function and a message inside the <code>main</code> func in the <code>main.go</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// root.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
     <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;inside init&#34;</span>)
     <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">OnInitialize</span>(<span style="color:#a6e22e">initConfig</span>)
<span style="color:#f92672">...</span>

<span style="color:#75715e">// main.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
     <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;inside main&#34;</span>)
     <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Execute</span>()
}
</code></pre></div><p>Save the changes. Rebuild the binary <code>go install my-calc</code> and run <code>my-calc</code>.</p>
<p><img src="./asset-5.png" alt="cli flow"></p>
<p>Now, you know the cli command flow.</p>
<p>The last thing in the <code>init</code> function is <code>flags</code>¬†.</p>
<p>Flags are like modifiers to the command. You can think of them as conditional actions. We will learn more about it later in the tutorial.</p>
<p>There are 2 types of flags <code>Persistent Flags</code> and <code>Local Flags</code>.</p>
<ul>
<li><strong>Persistent Flags:</strong> This flag will be available to the command it is assigned as well as all the child or subcommands of the command.</li>
<li><strong>Local Flags:</strong> This flag is only available to the command which it is assigned to.</li>
</ul>
<hr>
<h3 id="initconfig">initConfig</h3>
<p>This function is setting the configuration path in the home directory and config filename is¬†<code>.my-calc</code>¬†. It will use the configuration file if it exists.</p>
<p>The <code>viper</code> library is famous for configuration solution for go application. It reads from JSON, TOML, YAML, HCL, envfile and Java properties config files. It does much more than reading configuration. To learn more about it, follow this <a href="https://github.com/spf13/viper">link</a>.</p>
<p>With this function, we completed the <code>root.go</code> examination. It is a bit lengthier, but it is good to understand what we are using.</p>
<blockquote>
<p><strong>Note:</strong> Now if you want, you can remove all the print statements from the <code>root.go</code> and <code>main.go</code>¬†. I have removed all the print statements to keep the code clean.</p>
</blockquote>
<hr>
<p>It‚Äôs time to add some commands in our cli. We already created one command which is <code>my-calc</code> as<code>rootCmd</code> which returns <strong>Hello CLI.</strong></p>
<h3 id="add-numbers">add numbers</h3>
<p>Open the terminal inside the project directory and create a command named <code>add</code>¬†. The cobra command to add a new command is</p>
<p><code>cobra add &lt;commandName&gt;</code></p>
<pre><code>cobra add add

// output
add created at C:\Work\golang\my-calc
</code></pre><p>Check the <code>cmd</code> folder, an <code>add.go</code> file is added in it.</p>
<p>Open the <code>add.go</code>¬†. It is similar to the <code>root.go</code>¬†.</p>
<p>First, an <code>addCmd</code> struct variable is declared of type <code>*cobra.Command</code>¬†.</p>
<p>The <code>*cobra.Command</code> have <code>RUN</code> which is a func and takes pointer of <code>*cobra.Command</code> and a slice of string <code>[]string</code>.</p>
<p>Then it is initialized in <code>init</code> function. In the <code>init</code>, it is added to the <code>rootCmd</code>. We can understand it as <code>addCmd</code>is the sub-command or child command of the <code>rootCmd</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
   <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">addCmd</span>)
</code></pre></div><p>In the terminal, rebuild the binary using <code>go install my-calc</code> command and run <code>my-calc add</code>.</p>
<p><img src="./asset-6.png" alt="add called"></p>
<p>The <code>add</code> command is working fine. It‚Äôs time to modify it to add a series of numbers.</p>
<p>The commands only take a slice of string as an argument. To add the numbers, we first have to convert the <code>string</code> into <code>int</code> then return the result. We will use <code>strconv</code> library to convert the <code>string</code> to <code>int</code>.</p>
<p>Import the <code>strconv</code> package.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">import</span> (
   <span style="color:#e6db74">&#34;fmt&#34;</span>
   <span style="color:#e6db74">&#34;strconv&#34;</span>

   <span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
)
</code></pre></div><p>Inside the <code>add.go</code>, create a new <code>addInt</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// add.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">addInt</span>(<span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {

   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sum</span> <span style="color:#66d9ef">int</span>

  <span style="color:#75715e">// iterate over the arguments
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// the first return value is index of args, we can omit it using _
</span><span style="color:#75715e"></span>
   <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ival</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">args</span> {

 <span style="color:#75715e">// strconv is the library used for type conversion. for string
</span><span style="color:#75715e"></span> <span style="color:#75715e">// to int conversion Atio method is used.
</span><span style="color:#75715e"></span>       <span style="color:#a6e22e">itemp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">ival</span>)

       <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
           <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
       }
       <span style="color:#a6e22e">sum</span> = <span style="color:#a6e22e">sum</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">itemp</span>
    }

   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Addition of numbers %s is %d&#34;</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">sum</span>)
}
</code></pre></div><p>Save the changes.</p>
<p>In the <code>addCmd</code> variable, update the <code>RUN</code> func. Remove the print message and call the <code>addInt</code> function with <code>args</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// addCmd
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
  <span style="color:#a6e22e">addInt</span>(<span style="color:#a6e22e">args</span>)
},
</code></pre></div><p>Rebuild the binary using <code>go install my-calc</code>¬†.</p>
<p>Run <code>my-calc add 2 3</code>¬†.</p>
<blockquote>
<p>‚ö†Ô∏èDon‚Äôt forget the space between the arguments.</p>
</blockquote>
<p><img src="./asset-7.png" alt="add int"></p>
<p>You can pass as many arguments as you want. If you remember the args is a slice of string. But there is a limitation in this function. It can only add integers not decimal number. In the <code>addInt</code> function we are converting the string into <code>int</code> not in <code>float32/64</code>¬†.</p>
<p>It is time to introduce a <code>flag</code> in the <code>addCmd</code>¬†. This flag will help the cli to decide if it is an <code>int</code> operation or <code>float</code>.</p>
<p>In the <code>add.go</code>¬†, inside the <code>init</code> func, create a local flag of the bool type, <code>Flags().BoolP</code>. Its name will be <code>float</code>¬†, shortened name <code>f</code>¬†, default value <code>false</code> and description. The default value is very important. It means even if flag is not called in the command, the flag value will be <code>false</code>¬†. For bool type, if a flag is called it will toggle the default.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// add.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
 <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">addCmd</span>)
 <span style="color:#a6e22e">addCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">BoolP</span>(<span style="color:#e6db74">&#34;float&#34;</span>, <span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;Add Floating Numbers&#34;</span>)
}
</code></pre></div><p>Create a new <code>addFloat</code> function in the <code>add.go</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// add.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">addFloat</span>(<span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sum</span> <span style="color:#66d9ef">float64</span>

    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">fval</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">args</span> {
    <span style="color:#75715e">// convert string to float64
</span><span style="color:#75715e"></span>       <span style="color:#a6e22e">ftemp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">fval</span>, <span style="color:#ae81ff">64</span>)

       <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
          <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
       }
       <span style="color:#a6e22e">sum</span> = <span style="color:#a6e22e">sum</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ftemp</span>
    }

    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Sum of floating numbers %s is %f&#34;</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">sum</span>)
}
</code></pre></div><p>This function is the same as <code>addInt</code> except, it is converting <code>string</code> to <code>float64</code>.</p>
<p>In the <code>addCmd</code> <code>RUN</code> function, it will call the <code>addInt</code> or <code>addFloat</code> according to the flag. If flag <code>--float or -f</code> is passed then it will call <code>addFloat</code>¬†.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// add.go
</span><span style="color:#75715e"></span><span style="color:#75715e">// addCmd
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
 <span style="color:#75715e">// get the flag value, its default value is false
</span><span style="color:#75715e"></span> <span style="color:#a6e22e">fstatus</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">GetBool</span>(<span style="color:#e6db74">&#34;float&#34;</span>)

 <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">fstatus</span> { <span style="color:#75715e">// if status is true, call addFloat
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">addFloat</span>(<span style="color:#a6e22e">args</span>)
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">addInt</span>(<span style="color:#a6e22e">args</span>)
  }
},
</code></pre></div><p>Save all the changes. Rebuild the binary using <code>go install my-calc</code>.</p>
<p>Run <code>my-calc add 1.2 2.5 -f</code> or <code>my-calc add 1.2 2.5 --float</code></p>
<p><img src="./asset-8.png" alt="add float¬†flag"></p>
<p>You can do lots of things with flags. You can even pass values to flags like a slice of int, float, string etc.</p>
<p>The basic addition of operation implementation is completed.</p>
<p>Let‚Äôs expand it by adding sub-commands to the <code>addCmd</code>.</p>
<hr>
<h3 id="add-evennumbers">add even¬†numbers</h3>
<p>Open the terminal in the project directory and create a new <code>even</code> command.</p>
<pre><code>cobra add even
</code></pre><p>The <code>even</code> command as <code>even.go</code> added in the <code>cmd</code> folder.</p>
<p>Open the <code>even.go</code> in the editor. Change <code>rootCmd</code> to <code>addCmd</code> in the <code>init</code>¬†.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// even.go
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
    <span style="color:#a6e22e">addCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">evenCmd</span>)
<span style="color:#f92672">...</span>
}
</code></pre></div><p>The <code>addCmd.AddCommand(evenCmd)</code> will add <code>evenCmd</code> as child or subcommand of the <code>addCmd</code>¬†.</p>
<p>Update the <code>evenCmd</code> struct variable‚Äôs <code>RUN</code> method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// even.go
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {

   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">evenSum</span> <span style="color:#66d9ef">int</span>
   <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ival</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">args</span> {
      <span style="color:#a6e22e">itemp</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">ival</span>)
      <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">itemp</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
         <span style="color:#a6e22e">evenSum</span> = <span style="color:#a6e22e">evenSum</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">itemp</span>
      }
   }

   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;The even addition of %s is %d&#34;</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">evenSum</span>)
},
</code></pre></div><p>It will first convert the <code>string</code> into <code>int</code> using <code>strconv</code> package, then adding only even numbers.</p>
<p>Save all the changes. Rebuild the binary using <code>go install my-calc</code>¬†.</p>
<p>Run <code>my-calc add even 1 2 3 4 5 6</code></p>
<p><img src="./asset-9.png" alt="add even"></p>
<p>The <code>my-calc</code> is the root command, <code>add</code> it the command of the <code>rootCmd</code> and <code>even</code> is the command (subcommand) of the <code>addCmd</code>¬†.</p>
<hr>
<h3 id="add-oddnumbers">add odd¬†numbers</h3>
<p>This is same as <code>evenCmd</code>¬†. Instead of adding even numbers, it will add odd numbers.</p>
<p>Open the terminal in the project directory and create a new odd command.</p>
<pre><code>cobra add odd
</code></pre><p>The <code>odd</code> command as <code>odd.go</code> added in the <code>cmd</code> folder.</p>
<p>Open the <code>odd.go</code> in the editor. Change <code>rootCmd</code> to <code>addCmd</code> in the <code>init</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// odd.go
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
    <span style="color:#a6e22e">addCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">oddCmd</span>)
<span style="color:#f92672">...</span>
}
</code></pre></div><p>The <code>addCmd.AddCommand(oddCmd)</code> will add <code>oddCmd</code> as child or subcommand of the <code>addCmd</code>.</p>
<p>Update the <code>oddCmd</code> struct variable‚Äôs <code>RUN</code> method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// odd.go
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">oddSum</span> <span style="color:#66d9ef">int</span>
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ival</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">args</span> {
      <span style="color:#a6e22e">itemp</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">ival</span>)
      <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">itemp</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
         <span style="color:#a6e22e">oddSum</span> = <span style="color:#a6e22e">oddSum</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">itemp</span>
      }
    }

    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;The odd addition of %s is %d&#34;</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">oddSum</span>)
},
</code></pre></div><p>It will first convert the <code>string</code> into <code>int</code> using <code>strconv</code> package, then adding only even numbers.</p>
<p>Save all the changes. Rebuild the binary using <code>go install my-calc</code>.</p>
<p>Run <code>my-calc add odd 1 2 3 4 5 6</code></p>
<p><img src="./asset-10.png" alt=""></p>
<p>The <code>my-calc</code> is the root command, <code>add</code> it the command of the <code>rootCmd</code> and <code>odd</code> is the command (subcommand) of the <code>addCmd</code>.</p>
<hr>
<p>Congratulations! You created your own cli in golang with cobra.</p>
<blockquote>
<p>The complete code is saved on¬†<a href="https://github.com/schadokar/my-calc.git">Github</a>.</p>
</blockquote>
<p>The <code>my-calc</code> cli project is complete. The main aim of this tutorial to understand the basics of the cobra library. The tutorial covered most of the basic operations required to create a cli. I will keep updating it with more basic operations if it requires. I hope I smoothened the learning curve of creating cli. Thanks for your time to read the tutorial. I hope you learned something and it is worth your time.</p>
<p>Please give your valuable feedback on this tutorial. I‚Äôll make changes accordingly.</p>
<p>If you like my work and want to support me. You can buy me a coffee.</p>
<p><a href="https://www.buymeacoffee.com/uTDINEc"><img src="./asset-11.png" alt=""></a></p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/posts/build-a-todo-app-in-golang-mongodb-and-react/">Build a Todo App in Golang, MongoDB, and React</a></li>
	
	<li><a href="/posts/hyperledger-fabric-installation-guide/">Hyperledger Fabric Installation Guide!</a></li>
	
	<li><a href="/posts/create-an-ethereum-dapp-with-react-and-docker/">Create an Ethereum Dapp with React and Docker</a></li>
	
	<li><a href="/posts/deploy-angular-application-on-azure-web-service/">Deploy Angular application on Azure Web Service</a></li>
	
</ul>
</div>
      
    </div>
    

    <div>
  <iframe style="margin-top: 20px" width="100%" height="200px" src="https://schadokar.substack.com/embed"
    frameborder="0" scrolling="no"></iframe>
</div>

  </div>
</section>




<section class="section">
  
  <div class="container">
    <p>&copy; <a href="https://github.com/schadokar">Shubham Chadokar</a> 2020</p>
    
    
    
  </div>
</section>

<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/matomo.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  <img src="//matomo.example.com/piwik.php?idsite=1&amp;rec=1" style="border:0" alt="" />
</noscript>

<script>
    (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
            (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
    })(document, window, '\/\/fathom.example.com\/tracker.js', 'fathom');
    fathom('trackPageview');
</script>
</body>

</html>